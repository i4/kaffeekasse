{% extends "base.html" %}

{% block navbar_items %}
<li class="nav-item active">
    <a class="nav-link font-lg" href="#">Shop</a>
</li>
<li class="nav-item">
    <a class="nav-link font-lg" href="/store/charge">Aufladen</a>
</li>
<li class="nav-item">
    <a class="nav-link font-lg" href="/store/transfer">Ãœberweisen</a>
</li>
{% endblock %}

{% block content %}
{% comment %} Product list {% endcomment %}
<div class="row">
    <div class="col-lg-3 col-md-6 col-12 pb-4">
        <h4>H&auml;ufig gekauft</h4>
        <ul class="list-group">
            <button type="button" class="list-group-item list-group-item-action">
                <div class="d-flex w-100 justify-content-between">
                    <div class="mb-1">Kaffee</div>
                    <div>1,50 &euro;</div>
                </div>
            </button>
        </ul>
    </div>
    <div class="col-lg-3 col-md-6 col-12 pb-4">
        <h4>Getr&auml;nke</h4>
        <ul class="list-group">
            {% for drink in drinks %}
                <button onclick="buy({{ drink.id }})" type="button" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <div class="mb-1">{{ drink.name }}</div>
                        <div> {{ drink.price }} &euro;</div>
                    </div>
                </button>
            {% endfor %}
        </ul>
    </div>
    <div class="col-lg-3 col-md-6 col-12">
        <h4>Snacks</h4>
        <ul class="list-group">
            {% for candy in candies %}
                <button onclick="buy({{ candy.id }})" type="button" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <div class="mb-1">{{ candy.name }}</div>
                        <div> {{ candy.price }} &euro;</div>
                    </div>
                </button>
            {% endfor %}
        </ul>
    </div>
    <div class="col-lg-3 col-md-6 col-12">
        <h4>
            Letzte Eink&auml;ufe
            {% load static %}
            <button class="btn btn-i4 btn-sm">
                <img src="{% static "revert.svg" %}" width="20" height="20"/>
            </button>
        </h4>
        <ul class="list-group">
            <label class="list-group-item">
                <div class="d-flex w-100 justify-content-between">
                    <div class="mb-1">Kaffee</div>
                    <div>1,50 &euro;</div>
                </div>
            </label>
        </ul>
    </div>
</div>
{% endblock %}

{% block script %}
<script>

    const products = {
        {% for product in products %}
        {{ product.id }}: {
            price: {{ product.price }},
            name: "{{ product.name }}",
        },
        {% endfor %}
    }

    prepareAjax();

    function buy(id) {
        id = parseInt(id);
        if (isNaN(id)) {
            return;
        }

        $.ajax({
            url: "{% url "buy_product" %}",
            method: "POST",
            data: {product_id: id},
            success: function(data) {
                reduceMoney(products[id]["price"]);
                addLastBought(id);
            },
            error: function(error) {
                showError("Fehler beim Einkaufen!")
            }
        });
    }

    function addLastBought(id) {
        # TODO
    }

</script>
{% endblock %}